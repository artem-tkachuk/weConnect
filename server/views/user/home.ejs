<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>We connect!</title>
    </head>
    <body>

    <button id="stop">Stop</button>
    <button id="download">Download</button>

    <script>
        let recordedChunks = [];

        let options = {mimeType: 'audio/webm'};
        mediaRecorder = new MediaRecorder(stream, options);
        mediaRecorder.ondataavailable = handleDataAvailable;
        mediaRecorder.start();

        function handleDataAvailable(event) {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);
            } else {
                // ...
            }
        }

        let stopButton = document.getElementById('stop');
        let downloadButton = document.getElementById('download');

        stopButton.onclick = function(e) {
            mediaRecorder.stop();
        }

        downloadButton.onclick = function download() {
            var blob = new Blob(recordedChunks, {
                type: 'audio/webm'
            });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            document.body.appendChild(a);
            a.style = 'display: none';
            a.href = url;
            a.download = 'test.webm';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        navigator.mediaDevices.getUserMedia({ audio: true, video: false }).then(handleDataAvailable);
    </script>


    </body>
</html>